<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Digital Patient Record Management</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="images/logo.svg" type="image/svg+xml">
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <img src="images/logo.svg" alt="" class="logo-img" width="40" height="40">
        <span class="logo-text">Patient Record System</span>
      </a>
      <div class="nav-right">
        <a href="index.html" class="nav-menu-link">Home</a>
        <a href="patient-dashboard.html" class="nav-menu-link">Patient Dashboard</a>
        <a href="dashboard-choice.html" class="nav-menu-link">Dashboard</a>
        <button type="button" id="admin-sign-out" class="btn-login" style="background:none;border:none;cursor:pointer;font:inherit;color:inherit;">Sign out</button>
      </div>
    </div>
  </header>

  <main class="main-content dashboard-page-main">
    <div class="dashboard-page-inner">
      <h1 class="dashboard-page-title">Admin Dashboard</h1>
      <p class="dashboard-page-desc">System settings, users, and reports. Signed in as <strong id="admin-user-email"></strong>.</p>
      <div class="dashboard-placeholder">
        <p>Administrator tools and reports will appear here.</p>
        <a href="patient-dashboard.html" class="btn btn-primary">Go to Patient Dashboard</a>
        <a href="dashboard-choice.html" class="btn btn-secondary">Back to dashboard choice</a>
      </div>
      <!-- Link to Firebase so you can see your database -->
      <section class="dashboard-db-section" aria-labelledby="db-heading">
        <h2 id="db-heading" class="section-title">Your database (Firebase)</h2>
        <p class="dashboard-db-desc">View and manage users and data in the Firebase Console.</p>
        <a id="firebase-console-link" href="https://console.firebase.google.com/" target="_blank" rel="noopener noreferrer" class="btn btn-primary">Open Firebase Console →</a>
        <p class="dashboard-db-hint">In the console: use <strong>Authentication</strong> to see who signed in, and <strong>Firestore Database</strong> to see stored data (e.g. login log).</p>
        <div id="admin-login-log" class="admin-login-log"></div>
      </section>
    </div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="js/firebase-config.js"></script>
  <script>if (window.initFirebase) window.initFirebase();</script>
  <script src="js/firebase-auth.js"></script>
  <script>
    (function () {
      function redirectToLogin() { window.location.replace('login.html'); }
      if (typeof firebase === 'undefined' || !firebase.auth) { redirectToLogin(); return; }
      firebase.auth().onAuthStateChanged(function (user) {
        if (!user) { redirectToLogin(); return; }
        var emailEl = document.getElementById('admin-user-email');
        if (emailEl) emailEl.textContent = user.email || user.uid;
        var link = document.getElementById('firebase-console-link');
        if (link && firebase.app().options && firebase.app().options.projectId) {
          link.href = 'https://console.firebase.google.com/project/' + firebase.app().options.projectId;
        }
        var logEl = document.getElementById('admin-login-log');
        if (logEl && firebase.firestore) {
          firebase.firestore().collection('loginLog').orderBy('timestamp', 'desc').limit(10).get().then(function (snap) {
            if (snap.empty) return;
            var html = '<h3>Recent logins (from Firestore)</h3><ul>';
            snap.forEach(function (d) {
              var data = d.data();
              var ts = data.timestamp && data.timestamp.toDate ? data.timestamp.toDate().toLocaleString() : '';
              html += '<li>' + (data.email || '—') + (ts ? ' — ' + ts : '') + '</li>';
            });
            html += '</ul>';
            logEl.innerHTML = html;
          }).catch(function () {});
        }
      });
      document.getElementById('admin-sign-out').addEventListener('click', function () {
        if (window.firebaseSignOut) window.firebaseSignOut(); else window.location.href = 'login.html';
      });
    })();
  </script>
</body>
</html>
